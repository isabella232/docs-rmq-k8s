---
title: Installing RabbitMQ for VMware Tanzu &#91;Kubernetes&#93;
owner: RMQ for k8s
---

<strong><%= modified_date %></strong>

This topic describes how to install and configure <%= vars.product_full %>.
To install and configure <%= vars.product_full %> using a Helm chart hosted on <%= vars.product_network %>, follow
the steps in
[Installing RabbitMQ for VMware Tanzu &#91;Kubernetes&#93; Using a Helm Chart](./installing-with-helm.html).

## <a id='prerequisites'></a> Prerequisites

Before you install and configure <%= vars.product_short %>, you must install and configure:

1. **kubectl:** For installation instructions,
see the [Kubernetes documentation](https://kubernetes.io/docs/tasks/tools/install-kubectl/).

1. **The Docker CLI:** For installation instructions,
see the [Docker documentation](https://docs.docker.com/install/).

1. **A Kubernetes cluster:** You must use Kubernetes v1.14 or later. A default StorageClass has to be configured
or you need to specify which StorageClass to use.

1. **A private image registry:** VMware recommends that you keep the Kubernetes Operator
image private even if your registry is publicly accessible.
If you do not have access to a private image registry, email the team at rabbitmq-for-k8s@pivotal.io for help.

## <a id='overview'></a> Overview

To install and configure <%= vars.product_short %>:

1. [Download <%= vars.product_full %>](#artifact)
1. [Set a Version Variable](#set-ver-var)
1. [Move the Images](#relocate)
1. [Create the Namespace and Role-Based Access Control Objects](#namespace-rbac)
1. [(Optional) Configure Kubernetes Cluster Access to Private Images](#private-images)
1. [Configure the Image Registry](#image-repo)
1. [Install <%= vars.product_short %>](#deploy-op)

## <a id='artifact'></a> Download <%= vars.product_short %>

To download the <%= vars.product_short %> artifact:

1. Download the **<%= vars.product_short %>** artifact from
[<%= vars.product_network %>](https://network.pivotal.io/products/p-rabbitmq-for-kubernetes/).

The artifact contains Docker images, deployment manifests for the Kubernetes Operator, and a Helm chart.
You can deploy <%= vars.product_short %> with the Helm chart by using Container Service Manager (KSM).
For more information, see [Using <%= vars.product_full %> with Container Service Manager](./ksm.html).
<br><br>
The images are for:

* RabbitMQ
* The Kubernetes Operator

## <a id='set-ver-var'></a> Set a Version Variable

To set a version variable:

1. Run:

    ```
    export version=NUMBER-build.NUMBER
    ```

    Where `NUMBER` is the installation artifact version listed in the name of the artifact file you downloaded.<br><br>
    For example:

    <pre class="terminal">
    export version=0.6.0-build.22
    </pre>

## <a id='relocate'></a> Move the Images

To move the images:

1. Load the images to your local Docker by running these commands:

    ```
    mkdir rabbitmq-for-kubernetes-${version}
    ```

    ```
    tar -C rabbitmq-for-kubernetes-${version} -xf rabbitmq-for-kubernetes-${version}.tar
    ```

    ```
    cd rabbitmq-for-kubernetes-${version}
    ```

    ```
    docker load -i images/rabbitmq-for-kubernetes-operator
    ```

    ```
    docker load -i images/rabbitmq
    ```

1. Tag each image to point to your own image registry by running these commands:

    ```
    docker tag registry.pivotal.io/p-rabbitmq-for-kubernetes-staging/rabbitmq \
      YOUR-REGISTRY/rabbitmq:$version
    ```

    ```
    docker tag registry.pivotal.io/p-rabbitmq-for-kubernetes-staging/rabbitmq-for-kubernetes-operator \
      YOUR-REGISTRY/rabbitmq-for-kubernetes-operator:$version
    ```

1. Push each image to your own image registry by running these commands:

    ```
    docker push YOUR-REGISTRY/rabbitmq:$version
    ```

    ```
    docker push YOUR-REGISTRY/rabbitmq-for-kubernetes-operator:$version
    ```

## <a id='namespace-rbac'></a> Create the Namespace and Role-Based Access Control Objects

To create the namespace and role-based access control (RBAC) objects:

1. Create a `pivotal-rabbitmq-system` namespace by running:

    ```
    kubectl apply -f manifests/namespace.yaml
    ```

1. Create RBAC objects in the `pivotal-rabbitmq-system` namespace by running:

    ```
    kubectl apply -f manifests/rbac.yaml
    ```

## <a id='private-images'></a> (Optional) Configure Kubernetes Cluster Access to Private Images

If you require authentication to pull images from your private image registry, you must authorize access to the
images from the `pivotal-rabbitmq-system` namespace.

<p class=note>
  <strong>Note:</strong> If your registry is publicly accessible, VMware recommends that you keep your
  Kubernetes Operator image in a private image registry.
</p>

To authorize access to images:

1. Create a secret for your private image registry by running:

    ```
    kubectl -n pivotal-rabbitmq-system create secret \
    docker-registry p-rmq-registry-access \
    --docker-server=DOCKER-SERVER \
    --docker-username=DOCKER-USERNAME \
    --docker-password=DOCKER-PASSWORD
    ```

    Where:
    + `DOCKER-SERVER` is the server URL for your private image registry.
    + `DOCKER-USERNAME` is your username for your private image registry authentication.
    + `DOCKER-PASSWORD` is your password for your private image registry authentication.

    For example:
    <pre class="terminal">
    $ kubectl -n pivotal-rabbitmq-system create secret \
    docker-registry p-rmq-registry-access \
    --docker-server=docker.io/my-registry \
    --docker-username=my-username \
    --docker-password=example-password1
    secret/p-rmq-registry-access created
    </pre>

1. Update your service account by running:

    ```
    kubectl -n pivotal-rabbitmq-system patch serviceaccount \
    p-rmq-operator -p '{"imagePullSecrets": [{"name": "p-rmq-registry-access"}]}'
    ```

## <a id='image-repo'></a> Configure the Image Registry

To configure the image registry:

1. Edit `manifests/operator.yaml`.
1. Replace all instances of `REPLACE-WITH-OPERATOR-IMAGE-URL` with the full Kubernetes Operator image reference.
This reference should look similar to the below:

    ```
    image: YOUR-REGISTRY/rabbitmq-for-kubernetes-operator:$version
    ```

## <a id='deploy-op'></a> Install <%= vars.product_short %>

To install <%= vars.product_short %>:

1. Run:

    ```
    kubectl apply -f manifests/
    ```

1. Apply the Kubernetes manifests you configured in the above steps. When you do so, kubectl:
    * Deploys the Kubernetes Operator
    * Installs the `RabbitmqCluster` custom resource definition (CRD)

To uninstall the product, follow the steps in [Uninstall Through the Manifests](./upgrading.html#uninstall-manifests).
